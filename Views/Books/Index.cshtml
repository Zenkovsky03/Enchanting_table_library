@model Biblioteka.Models.BooksBrowseViewModel

@{
    ViewData["Title"] = "Przeglądaj książki";
}

<div class="container py-4">
    <div class="row">
        <!-- Main Content Area -->
        <div class="col-12 col-lg-8 col-xl-9">
            <!-- Page Heading -->
            <div class="page-heading mb-4">
                <h1>Przeglądaj naszą kolekcję</h1>
                <p>Znajdź swoją następną ulubioną książkę do wypożyczenia.</p>
            </div>

            <!-- Search & Filters -->
            <form method="get" class="mb-4">
                <div class="d-flex flex-column flex-sm-row gap-3 mb-3">
                    <div class="search-bar flex-grow-1">
                        <span class="material-symbols-outlined">search</span>
                        <input type="text" name="q" value="@Model.Q" placeholder="Szukaj po tytule lub autorze" />
                    </div>
                    <div class="d-flex align-items-center gap-2 flex-grow-1 flex-sm-grow-0" style="min-width: 200px;">
                        <div class="filter-select flex-grow-1">
                            <span class="material-symbols-outlined">sell</span>
                            <select name="tagId">
                                <option value="">Wszystkie tagi</option>
                                @foreach (var t in Model.Tags)
                                {
                                    <option value="@t.Id" selected="@(Model.TagId == t.Id)">@t.Name</option>
                                }
                            </select>
                        </div>
                        <button class="btn btn-primary" type="submit">
                            <span class="material-symbols-outlined">filter_list</span>
                        </button>
                    </div>
                </div>

                @if (Model.CategoryId.HasValue)
                {
                    <input type="hidden" name="categoryId" value="@Model.CategoryId" />
                }
            </form>

            <!-- Category Chips -->
            <div class="d-flex flex-wrap gap-2 mb-4">
                <a class="filter-chip @(Model.CategoryId == null ? "active" : "")"
                   asp-action="Index" asp-route-q="@Model.Q" asp-route-tagId="@Model.TagId">Wszystkie</a>
                @foreach (var c in Model.Categories)
                {
                    <a class="filter-chip @(Model.CategoryId == c.Id ? "active" : "")"
                       asp-action="Index" asp-route-categoryId="@c.Id" asp-route-q="@Model.Q" asp-route-tagId="@Model.TagId">@c.Name</a>
                }
            </div>

            <!-- Book Grid -->
            @if (Model.Books.Count == 0)
            {
                <div class="empty-state">
                    <span class="material-symbols-outlined">search_off</span>
                    <h3>Brak wyników</h3>
                    <p>Nie znaleziono książek spełniających kryteria wyszukiwania.</p>
                </div>
            }
            else
            {
                <div class="book-grid">
                    @foreach (var book in Model.Books)
                    {
                        <div class="book-card">
                            <a asp-action="Details" asp-route-id="@book.Id" class="book-cover">
                                <div class="book-cover-placeholder">
                                    <span class="material-symbols-outlined">menu_book</span>
                                </div>
                            </a>
                            <div class="book-info">
                                <a asp-action="Details" asp-route-id="@book.Id" class="book-title">@book.Title</a>
                                <div class="book-author">@book.Author</div>
                                <div class="book-stock">
                                    @if (book.StockCount > 0)
                                    {
                                        <span class="badge-status available">Dostępne: @book.StockCount</span>
                                    }
                                    else
                                    {
                                        <span class="badge-status unavailable">Niedostępne</span>
                                    }
                                </div>
                                <div class="book-actions">
                                    @if (book.StockCount > 0)
                                    {
                                        <form asp-controller="Cart" asp-action="Add" method="post" class="d-inline w-100">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@book.Id" />
                                            <input type="hidden" name="quantity" value="1" />
                                            <button type="submit" class="btn btn-primary btn-sm w-100">
                                                <span class="material-symbols-outlined">add_shopping_cart</span>
                                                Do koszyka
                                            </button>
                                        </form>
                                    }
                                    else
                                    {
                                        <form asp-controller="Books" asp-action="JoinQueue" method="post" class="d-inline w-100">
                                            @Html.AntiForgeryToken()
                                            <input type="hidden" name="id" value="@book.Id" />
                                            <button type="submit" class="btn btn-outline-primary btn-sm w-100">
                                                <span class="material-symbols-outlined">queue</span>
                                                Do kolejki
                                            </button>
                                        </form>
                                    }
                                </div>
                            </div>
                        </div>
                    }
                </div>
            }
        </div>

        <!-- Cart Sidebar -->
        <div class="col-12 col-lg-4 col-xl-3 mt-4 mt-lg-0">
            <div class="cart-sidebar">
                <div class="cart-header">
                    <h3>
                        <span class="material-symbols-outlined">shopping_cart</span>
                        Twój koszyk
                    </h3>
                    <span class="cart-count">@Model.CartCount</span>
                </div>

                @if (Model.CartCount > 0)
                {
                    <p class="text-center text-muted mb-3">Masz @Model.CartCount książek w koszyku</p>

                    <div class="cart-footer">
                        <a asp-controller="Cart" asp-action="Index" class="btn btn-outline-secondary w-100 mb-2">
                            <span class="material-symbols-outlined">shopping_cart</span>
                            Zobacz koszyk
                        </a>
                        <a asp-controller="Cart" asp-action="Checkout" class="btn btn-primary w-100">
                            <span class="material-symbols-outlined">shopping_cart_checkout</span>
                            Złóż zamówienie
                        </a>
                    </div>
                }
                else
                {
                    <div class="cart-empty">
                        <span class="material-symbols-outlined">shopping_cart_off</span>
                        <p>Twój koszyk jest pusty</p>
                        <small>Zacznij przeglądać książki!</small>
                    </div>
                }
            </div>
        </div>
    </div>
</div>
